# modelname.dag
# 2018.04 Carolyn Voter
# DAG for PF model

#-------------------------------
#List all Jobs
#-------------------------------
# Pre-processing 
JOB tar /home/cvoter/PFscripts/inputsCreateTAR.sub
JOB sa /home/cvoter/PFscripts/inputsConvertSA.sub

#Run Parflow
JOB run /home/cvoter/PFscripts/runParflow.sub

#Rearrange Parflow
JOB retar /home/cvoter/PFscripts/outputsRearrangeTAR.sub

# Convert to Matlab
JOB clm /home/cvoter/PFscripts/outputsCreateMatlab.sub
JOB sub /home/cvoter/PFscripts/outputsCreateMatlab.sub
JOB etS /home/cvoter/PFscripts/outputsCreateMatlab.sub
JOB p /home/cvoter/PFscripts/outputsCreateMatlab.sub
JOB sat /home/cvoter/PFscripts/outputsCreateMatlab.sub
JOB sr /home/cvoter/PFscripts/outputsCreateMatlab.sub

# Calculate from Matlab
JOB evL /home/cvoter/PFscripts/outputsCalculateMatlab.sub
JOB ev /home/cvoter/PFscripts/outputsCalculateMatlab.sub
JOB dd /home/cvoter/PFscripts/outputsCalculateMatlab.sub
Job re /home/cvoter/PFscripts/outputsCalculateMatlab.sub
JOB Sss /home/cvoter/PFscripts/outputsCalculateMatlab.sub
JOB Ss /home/cvoter/PFscripts/outputsCalculateMatlab.sub

# Calculate Water Balance
JOB wb /home/cvoter/PFscripts/outputsWaterBalanceMatlab.sub

#-------------------------------
# Parent-Child Relationships
#-------------------------------
PARENT tar CHILD sa
PARENT sa CHILD run
PARENT run CHILD retar
PARENT retar CHILD clm sub etS p sat sr

# Before Matlab calculations
PARENT clm  CHILD evL
PARENT evL CHILD ev
PARENT p CHILD Ss
PARENT p sub CHILD dd re
PARENT p sub sat CHILD Sss
PARENT etS clm evL ev sr dd re Sss Ss CHILD wb

#-------------------------------
# Variable inputs
#-------------------------------
# Pre-processing 
VARS tar runname="modelname"
VARS sa runname="modelname" nruns="insertnruns"

#Run Parflow
VARS run runname="modelname" totalHr="insertHr" drun="insertdrun" nruns="insertnruns" np="snp" mem="8GB" disk="20GB"

#Rearrange Parflow
VARS retar runname="modelname" totalHr="insertHr" drun="insertdrun" nruns="insertnruns" np="snp"

# Convert to Matlab
VARS clm runname="modelname" flux="clm_output" totalHr="insertHr" mem="16GB" disk="20GB"
VARS sub runname="modelname" flux="subsurface" totalHr="insertHr" mem="1GB" disk="3GB"
VARS etS runname="modelname" flux="evaptranssum" totalHr="insertHr" mem="10GB" disk="3GB"
VARS p runname="modelname" flux="press" totalHr="insertHr" mem="16GB" disk="20GB"
VARS sat runname="modelname" flux="satur" totalHr="insertHr" mem="16GB" disk="20GB"
VARS sr runname="modelname" flux="overlandsum" totalHr="insertHr" mem="1GB" disk="3GB"

# Calculate from Matlab
VARS evL runname="modelname" flux="qflx_evap_leaf" totalHr="insertHr" mem="1GB" disk="3GB"
VARS ev runname="modelname" flux="qflx_evap_all" totalHr="insertHr" mem="1GB" disk="3GB"
VARS dd runname="modelname" flux="deep_drainage" totalHr="insertHr" mem="16GB" disk="20GB"
VARS re runname="modelname" flux="recharge" totalHr="insertHr" mem="16GB" disk="20GB"
VARS Sss runname="modelname" flux="subsurface_storage" totalHr="insertHr" mem="16GB" disk="20GB"
VARS Ss runname="modelname" flux="surface_storage" totalHr="insertHr" mem="16GB" disk="20GB"
VARS wb runname="modelname"